<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Modrinth Explorer</title>
<style>
body { background:#0b1020;color:#e6eef8;font-family:sans-serif;padding:20px; }
input { padding:8px;margin:4px;width:300px; }
button { padding:6px;margin:2px; }
.panel { background:rgba(255,255,255,0.05);padding:12px;border-radius:8px;margin-top:12px; max-height:70vh; overflow-y:auto; }
.plugin-item { margin:4px 0; }
.plugin-item span { font-weight:bold; }
.plugin-item a { color:#90caf9; text-decoration:none; margin-left:4px; }
.plugin-item button { margin-left:8px; }
</style>
</head>
<body>
<h1>Modrinth Explorer — Tous les plugins</h1>
<div>
  <input id="searchInput" type="text" placeholder="Rechercher un plugin par nom">
  <button id="refreshBtn">Actualiser la liste</button>
</div>

<div class="panel">
  <div id="pluginsList">Chargement en cours…</div>
</div>

<script>
const $ = id => document.getElementById(id);
let plugins = [];

// Affichage et filtrage
function renderPlugins(filter=''){
  const out = $('pluginsList');
  const filtered = plugins.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
  if(!filtered.length){ out.innerHTML='Aucun plugin trouvé.'; return; }
  out.innerHTML = filtered.map((p,i)=>`
    <div class="plugin-item">
      <span>${p.name}</span> (v:${p.version || '-'})
      ${p.description ? '- '+p.description : ''}
      <a href="${p.url}" target="_blank">Modrinth</a>
      <button onclick="downloadPlugin('${p.modrinthId}')">Télécharger</button>
    </div>
  `).join('');
}

// Télécharger plugin
async function downloadPlugin(modrinthId){
  try{
    const res = await fetch(`https://api.modrinth.com/v2/project/${modrinthId}/version`);
    const data = await res.json();
    if(!data.length) return alert('Aucune version trouvée.');
    const fileUrl = data[0].files[0]?.url;
    if(!fileUrl) return alert('Fichier introuvable.');
    window.open(fileUrl,'_blank');
  }catch(e){
    console.error(e);
    alert('Erreur lors du téléchargement.');
  }
}

// Charger tous les plugins (paged API)
async function loadPlugins(){
  plugins = [];
  $('pluginsList').textContent = 'Chargement en cours…';
  try{
    let page = 0;
    const limit = 50; // nombre max par page
    let totalPages = 1;
    while(page < totalPages){
      const res = await fetch(`https://api.modrinth.com/v2/projects?limit=${limit}&offset=${page*limit}&facets=["mod"]`);
      const data = await res.json();
      if(!data.hits) break;
      totalPages = Math.ceil(data.total_hits / limit);
      const pagePlugins = data.hits.map(hit => ({
        name: hit.title,
        version: hit.latest_version,
        description: hit.description,
        url: `https://modrinth.com/plugin/${hit.slug}`,
        modrinthId: hit.id
      }));
      plugins.push(...pagePlugins);
      page++;
    }
    renderPlugins($('searchInput').value);
  }catch(e){
    console.error(e);
    $('pluginsList').textContent='Erreur lors du chargement.';
  }
}

// Événements
$('searchInput').addEventListener('input', ()=>renderPlugins($('searchInput').value));
$('refreshBtn').addEventListener('click', loadPlugins);

// Chargement initial
loadPlugins();
</script>
</body>
</html>
