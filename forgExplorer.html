<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Forg Explorer — Modrinth & Git</title>
<link rel="stylesheet" href="style-explorer.css">
</head>
<body>
<h1>Forg Explorer — Plugins Modrinth & Git</h1>

<div>
  <input id="searchInput" type="text" placeholder="Rechercher un plugin par nom">
  <button id="searchBtn">Rechercher</button>
</div>

<div class="panel">
  <div id="pluginsList">Entrez un mot-clé et cliquez sur Rechercher</div>
</div>

<script>
const $ = id => document.getElementById(id);
let plugins = [];

// Affichage filtré
function renderPlugins() {
  const out = $('pluginsList');
  if (!plugins.length) { out.innerHTML='Aucun plugin trouvé.'; return; }
  out.innerHTML = plugins.map(p => `
    <div class="plugin-item">
      <span>${p.name}</span> (v:${p.version || '-'})
      ${p.description ? '- '+p.description : ''}
      <a href="${p.url}" target="_blank">Modrinth</a>
      <button onclick="downloadPlugin('${p.modrinthId}')">Télécharger</button>
      <button onclick="fetchGitInfo('${p.gitHash}')">Git</button>
    </div>
  `).join('');
}

// Télécharger plugin depuis Modrinth
async function downloadPlugin(modrinthId) {
  try {
    const res = await fetch(`https://api.modrinth.com/v2/project/${modrinthId}/version`);
    const data = await res.json();
    if (!data.length) return alert('Aucune version trouvée.');
    const fileUrl = data[0].files[0]?.url;
    if (!fileUrl) return alert('Fichier introuvable.');
    window.open(fileUrl, '_blank');
  } catch(e) {
    console.error(e);
    alert('Erreur lors du téléchargement.');
  }
}

// Récupérer infos Git via ton API
async function fetchGitInfo(gitHash) {
  try {
    // Remplace cette URL par ton endpoint réel
    const res = await fetch(`https://ton-api-git.exemple.com/plugin/${gitHash}`);
    if (!res.ok) throw new Error('Erreur API Git');
    const data = await res.json();
    alert(`Plugin Git Info:\nNom: ${data.name}\nDernière version: ${data.version}`);
  } catch(e) {
    console.error(e);
    alert('Impossible de récupérer les infos Git.');
  }
}

// Recherche via Modrinth API
async function searchPlugins(query) {
  if (!query) { alert('Entrez un mot-clé'); return; }
  $('pluginsList').textContent = 'Chargement en cours…';
  try {
    const res = await fetch(`https://api.modrinth.com/v2/projects?limit=50&query=${encodeURIComponent(query)}`);
    const data = await res.json();
    if (!data.hits || !data.hits.length) { plugins = []; renderPlugins(); return; }
    plugins = data.hits.map(hit => ({
      name: hit.title,
      version: hit.latest_version,
      description: hit.description,
      url: `https://modrinth.com/plugin/${hit.slug}`,
      modrinthId: hit.id,
      gitHash: '977de0e18a70c6d8e7e0a9fab5bff68ad08207e3'
    }));
    renderPlugins();
  } catch(e) {
    console.error(e);
    $('pluginsList').textContent = 'Erreur lors de la recherche.';
  }
}

// Événements
$('searchBtn').addEventListener('click', ()=>searchPlugins($('searchInput').value));
$('searchInput').addEventListener('keypress', e => {
  if(e.key === 'Enter') searchPlugins($('searchInput').value);
});
</script>
</body>
</html>
