<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Forg Explorer — Modrinth & Git</title>
<link rel="stylesheet" href="style-explorer.css">
</head>
<body>
<h1>Forg Explorer — Plugins Modrinth & Git</h1>

<div>
  <input id="searchInput" type="text" placeholder="Rechercher un plugin par nom">
  <button id="refreshBtn">Actualiser</button>
</div>

<div class="panel">
  <div id="pluginsList">Chargement en cours…</div>
</div>

<script>
const $ = id => document.getElementById(id);
let plugins = [];

// Affichage filtré
function renderPlugins(filter=''){
  const out = $('pluginsList');
  const filtered = plugins.filter(p => p.name.toLowerCase().includes(filter.toLowerCase()));
  if(!filtered.length){ out.innerHTML='Aucun plugin trouvé.'; return; }
  out.innerHTML = filtered.map(p=>`
    <div class="plugin-item">
      <span>${p.name}</span> (v:${p.version || '-'})
      ${p.description ? '- '+p.description : ''}
      <a href="${p.url}" target="_blank">Modrinth</a>
      <button onclick="downloadPlugin('${p.modrinthId}')">Télécharger</button>
      ${p.gitHash ? `<button onclick="fetchGitInfo('${p.gitHash}')">Git</button>` : ''}
    </div>
  `).join('');
}

// Télécharger plugin depuis Modrinth
async function downloadPlugin(modrinthId){
  try{
    const res = await fetch(`https://api.modrinth.com/v2/project/${modrinthId}/version`);
    const data = await res.json();
    if(!data.length) return alert('Aucune version trouvée.');
    const fileUrl = data[0].files[0]?.url;
    if(!fileUrl) return alert('Fichier introuvable.');
    window.open(fileUrl,'_blank');
  }catch(e){
    console.error(e);
    alert('Erreur lors du téléchargement.');
  }
}

// Récupérer les infos Git via l’API (hash fourni)
async function fetchGitInfo(gitHash){
  try {
    // Remplace l’URL ci-dessous par ton endpoint réel
    const res = await fetch(`https://ton-api-git.exemple.com/plugin/${gitHash}`);
    if(!res.ok) throw new Error('Erreur API Git');
    const data = await res.json();
    alert(`Plugin Git Info:\nNom: ${data.name}\nDernière version: ${data.version}`);
  } catch(e) {
    console.error(e);
    alert('Impossible de récupérer les infos Git.');
  }
}

// Charger les plugins Modrinth (paged)
async function loadPlugins(query=''){
  plugins = [];
  $('pluginsList').textContent='Chargement en cours…';
  try{
    let page = 0;
    const limit = 50;
    let totalPages = 1;
    while(page < totalPages){
      const res = await fetch(`https://api.modrinth.com/v2/projects?limit=${limit}&offset=${page*limit}&query=${encodeURIComponent(query)}`);
      const data = await res.json();
      if(!data.hits) break;
      totalPages = Math.ceil(data.total_hits / limit);
      const pagePlugins = data.hits.map(hit => ({
        name: hit.title,
        version: hit.latest_version,
        description: hit.description,
        url: `https://modrinth.com/plugin/${hit.slug}`,
        modrinthId: hit.id,
        gitHash: '977de0e18a70c6d8e7e0a9fab5bff68ad08207e3' // hash par défaut
      }));
      plugins.push(...pagePlugins);
      page++;
      if(page > 3) break; // limite ~200 plugins
    }
    renderPlugins($('searchInput').value);
  }catch(e){
    console.error(e);
    $('pluginsList').textContent='Erreur lors du chargement.';
  }
}

// Événements
$('searchInput').addEventListener('input', ()=>renderPlugins($('searchInput').value));
$('refreshBtn').addEventListener('click', ()=>loadPlugins($('searchInput').value));

// Chargement initial
loadPlugins();
</script>
</body>
</html>
